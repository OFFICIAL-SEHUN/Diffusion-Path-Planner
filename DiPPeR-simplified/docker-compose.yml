version: '3.8'

services:
  dipper_app:
    build:
      context: .
      dockerfile: Dockerfile
    
    container_name: dipper_simplified_container

    # --- GUI 포워딩을 위한 설정 추가 ---
    environment:
      # 컨테이너 내의 DISPLAY 환경 변수를 호스트의 것과 동일하게 설정합니다.
      # 이렇게 하면 컨테이너의 GUI 앱이 어느 화면에 그려야 할지 알게 됩니다.
      - DISPLAY=${DISPLAY}
      # Matplotlib이 GUI 백엔드를 사용하도록 설정 (필요한 경우)
      - MPLBACKEND=TkAgg
      # X11 인증에 필요한 설정
      - QT_X11_NO_MITSHM=1

    volumes:
      # 기존 코드 동기화 볼륨
      - ./app:/usr/src/app
      # 호스트의 X11 소켓을 컨테이너에 마운트합니다.
      # GUI 애플리케이션이 호스트의 디스플레이 서버와 통신하기 위한 통로입니다.
      - /tmp/.X11-unix:/tmp/.X11-unix:rw

    # --- 나머지 설정은 동일 ---
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]

    stdin_open: true
    tty: true